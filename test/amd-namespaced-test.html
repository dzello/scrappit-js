<!-- Make sure to run 'make' before running this test! -->
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='Content-type' content='text/html; charset=utf-8'>
  <title>scrappit.js namespaced amd tests</title>
  <link rel='stylesheet' href='../vendor/qunit/qunit.css' type='text/css' charset='utf-8'>
  <script src='../vendor/qunit/qunit.js' type='text/javascript' charset='utf-8'></script>
  <script type='text/javascript' src='../build/scrappit-amd.js'></script>
  <script type='text/javascript'>
    function load(url, cb) {
      if (typeof(url) !== "string") {
        cb = url;
        url = "../build/scrappit-amd.js";
      }

      (function(g,b,d){var c=b.head||b.getElementsByTagName("head"),D="readyState",E="onreadystatechange",F="DOMContentLoaded",G="addEventListener",H=setTimeout;
      H(function(){if("item"in c){if(!c[0]){H(arguments.callee,25);return}c=c[0]}var a=b.createElement("script"),e=false;a.onload=a[E]=function(){if((a[D]&&a[D]!=="complete"&&a[D]!=="loaded")||e){return false}a.onload=a[E]=null;e=true;cb()};
      a.src=url;
      c.insertBefore(a,c.firstChild)},0);if(b[D]==null&&b[G]){b[D]="loading";b[G](F,d=function(){b.removeEventListener(F,d,false);b[D]="complete"},false)}})(this,document);
    }
  </script>
</head>
<body>
<h1 id='qunit-header'>scrappit.js namespaced AMD tests</h1>

<h2 id='qunit-banner'></h2>

<h2 id='qunit-userAgent'></h2>
<ol id='qunit-tests'></ol>

<script type='text/javascript' charset='utf-8'>
  var wait = 500;

  function ensureNoGlobalAmd() {
    equal(typeof define, "undefined");
    equal(typeof require, "undefined");
    equal(typeof requirejs, "undefined");
  }

  QUnit.module('nothing on the page');

  QUnit.test('scrappit should export with namespaced amd and no global amd', function() {
    ensureNoGlobalAmd();
    ok(scrappit.define);
    ok(scrappit.require);
    ok(scrappit.requirejs);
  });

  QUnit.module('existing scrappit on the page with amd');

  QUnit.test('adding scrappit-amd twice should not replace scrappit nor amd', function() {
    stop(wait);
    expect(2);
    var oldScrappit = scrappit,
        oldDefine = scrappit.define;
    load(function() {
      equal(scrappit, oldScrappit);
      equal(scrappit.define, oldDefine);
      start();
    });
  });

  QUnit.test('adding scrappit after scrappit-AMD without a namespace should still define the module', function() {
    stop(wait);
    expect(1);

    //the point of this test is to say - 'if scrappit is already defined and
    //has AMD, scrappit should still define itself so that the caller's require
    //matched up with a define, and the scrappit object gets passed along
    load('../scripts/lib/require.js', function() {
      window.require(['../scripts/src/scrappit.js'], function(_scrappit) {
        ok(_scrappit);
        start();
      });
    });
  });

  QUnit.module('existing scrappit on the page without amd');

  QUnit.test('adding scrappit-amd twice should not replace scrappit object but should add amd', function() {
    delete(scrappit.define);
    delete(scrappit.require);
    delete(scrappit.requirejs);

    stop(wait);
    expect(4);

    var oldScrappit = scrappit;
    load(function() {
      equal(scrappit, oldScrappit);
      ok(scrappit.define);
      ok(scrappit.require);
      ok(scrappit.requirejs);
      start();
    });
  });

</script>
</body>
</html>
